<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js" async defer></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js" async defer></script>

<script>
    // Hier konfigurieren Sie Firebase und definieren die Funktionen

    const firebaseConfig = {
        apiKey: "AIzaSyBydAxxqNvFuj6DBY7iD5P8UpZpYSq0_BE",
        authDomain: "alea-hotels-pfaffenhofen.firebaseapp.com",
        databaseURL: "https://alea-hotels-pfaffenhofen-default-rtdb.firebaseio.com",
        projectId: "alea-hotels-pfaffenhofen",
        storageBucket: "alea-hotels-pfaffenhofen.appspot.com",
        messagingSenderId: "851814894064",
        appId: "1:851814894064:web:bf95cfa03c52f957f93535",
        measurementId: "G-M82VZW2CYK"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    window.neuesProjekt = async function neuesProjekt() {
        const projektname = prompt("Projektname:");
        const projektdatum = prompt("Projektdatum:");
        if (!projektname || !projektdatum) return;

        const data = await loadGetraenke();
        const getraenke = data.getraenke.map(item => ({
            ...item,
            Projektname: projektname,
            Projektdatum: projektdatum,
            Zähler: 0
        }));

        const projektRef = database.ref(`projekte/${projektname}`);
        projektRef.set({ projektdatum, getraenke }).then(() => {
            alert("Neues Projekt erstellt.");
        }).catch(error => console.error("Fehler beim Erstellen des Projekts:", error));
    };

    window.projektOeffnen = async function projektOeffnen() {
        try {
            const snapshot = await database.ref('projekte').once('value');
            if (!snapshot.exists()) return alert("Keine Projekte gefunden.");

            const projekte = snapshot.val();
            const projektname = prompt("Projektname zum Öffnen eingeben:", Object.keys(projekte).join(", "));
            if (!projekte[projektname]) return alert("Projekt nicht gefunden.");

            const projekt = projekte[projektname];
            document.getElementById('projekt-info').textContent = `Projekt: ${projektname}, Datum: ${projekt.projektdatum}`;

            const container = document.getElementById('getraenke-container');
            container.innerHTML = '';

            projekt.getraenke.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item';

                const kategorie = document.createElement('div');
                kategorie.className = 'name';
                kategorie.textContent = item.Kategorie;

                const name = document.createElement('div');
                name.className = 'name';
                name.textContent = item.Name;

                const preis = document.createElement('div');
                preis.className = 'preis';
                preis.textContent = `€${item.Preis}`;

                const menge = document.createElement('div');
                menge.className = 'name';
                menge.textContent = item.Menge;

                const counterDiv = document.createElement('div');
                counterDiv.className = 'counter';

                const count = document.createElement('span');
                count.textContent = item.Zähler;
                count.className = 'count';

                const plusButton = document.createElement('button');
                plusButton.textContent = '+1';
                plusButton.className = 'button plus';
                plusButton.onclick = () => {
                    count.textContent = parseInt(count.textContent) + 1;
                    database.ref(`projekte/${projektname}/getraenke/${item.Name}`).update({ Zähler: parseInt(count.textContent) });
                };

                const minusButton = document.createElement('button');
                minusButton.textContent = '-1';
                minusButton.className = 'button minus';
                minusButton.onclick = () => {
                    count.textContent = Math.max(0, parseInt(count.textContent) - 1);
                    database.ref(`projekte/${projektname}/getraenke/${item.Name}`).update({ Zähler: parseInt(count.textContent) });
                };

                counterDiv.appendChild(minusButton);
                counterDiv.appendChild(count);
                counterDiv.appendChild(plusButton);

                itemDiv.appendChild(kategorie);
                itemDiv.appendChild(name);
                itemDiv.appendChild(preis);
                itemDiv.appendChild(menge);
                itemDiv.appendChild(counterDiv);

                container.appendChild(itemDiv);
            });
        } catch (error) {
            console.error("Fehler beim Öffnen des Projekts:", error);
        }
    };

    window.projektSpeichern = function projektSpeichern() {
        const projektname = document.getElementById('projekt-info').textContent.split(": ")[1];
        if (!projektname) return alert("Kein Projekt geöffnet.");

        const data = Array.from(document.querySelectorAll('.item')).map(item => ({
            name: item.querySelector('.name').textContent,
            zaehler: item.querySelector('.count').textContent
        }));

        const updates = {};
        data.forEach(item => {
            updates[`projekte/${projektname}/getraenke/${item.name}/Zähler`] = item.zaehler;
        });

        database.ref().update(updates)
            .then(() => alert("Projekt erfolgreich gespeichert."))
            .catch(error => console.error("Fehler beim Speichern:", error));
    };

    window.projektSchliessen = function projektSchliessen() {
        projektSpeichern();
        alert("Projekt wird geschlossen.");
        window.close();
    };
</script>
